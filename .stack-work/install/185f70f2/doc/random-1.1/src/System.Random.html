<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 701
</span><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-5"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Module      :  System.Random</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Copyright   :  (c) The University of Glasgow 2001</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- License     :  BSD-style (see the file LICENSE in the 'random' repository)</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- </span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Maintainer  :  libraries@haskell.org</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- Stability   :  stable</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- Portability :  portable</span><span>
</span><span id="line-14"></span><span class="hs-comment">--</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- This library deals with the common task of pseudo-random number</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- generation. The library makes it possible to generate repeatable</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- results, by starting with a specified initial random number generator,</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- or to get different results on each run by using the system-initialised</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- generator or by supplying a seed from some other source.</span><span>
</span><span id="line-20"></span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- The library is split into two layers: </span><span>
</span><span id="line-22"></span><span class="hs-comment">--</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- * A core /random number generator/ provides a supply of bits.</span><span>
</span><span id="line-24"></span><span class="hs-comment">--   The class 'RandomGen' provides a common interface to such generators.</span><span>
</span><span id="line-25"></span><span class="hs-comment">--   The library provides one instance of 'RandomGen', the abstract</span><span>
</span><span id="line-26"></span><span class="hs-comment">--   data type 'StdGen'.  Programmers may, of course, supply their own</span><span>
</span><span id="line-27"></span><span class="hs-comment">--   instances of 'RandomGen'.</span><span>
</span><span id="line-28"></span><span class="hs-comment">--</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- * The class 'Random' provides a way to extract values of a particular</span><span>
</span><span id="line-30"></span><span class="hs-comment">--   type from a random number generator.  For example, the 'Float'</span><span>
</span><span id="line-31"></span><span class="hs-comment">--   instance of 'Random' allows one to generate random values of type</span><span>
</span><span id="line-32"></span><span class="hs-comment">--   'Float'.</span><span>
</span><span id="line-33"></span><span class="hs-comment">--</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- This implementation uses the Portable Combined Generator of L'Ecuyer</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- [&quot;System.Random\#LEcuyer&quot;] for 32-bit computers, transliterated by</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- Lennart Augustsson.  It has a period of roughly 2.30584e18.</span><span>
</span><span id="line-37"></span><span class="hs-comment">--</span><span>
</span><span id="line-38"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span class="hs-cpp">

#include &quot;MachDeps.h&quot;
</span><span>
</span><span id="line-42"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System.Random</span><span>
</span><span id="line-43"></span><span>	</span><span class="hs-special">(</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span>	</span><span class="hs-comment">-- $intro</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span>	</span><span class="hs-comment">-- * Random number generators</span><span class="hs-cpp">

#ifdef ENABLE_SPLITTABLEGEN
</span><span>	  </span><span class="hs-identifier">RandomGen</span><span class="hs-special">(</span><span class="hs-identifier">next</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">genRange</span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>	</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">SplittableGen</span><span class="hs-special">(</span><span class="hs-identifier">split</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>	  </span><span class="hs-identifier">RandomGen</span><span class="hs-special">(</span><span class="hs-identifier">next</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">genRange</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">split</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>	</span><span class="hs-comment">-- ** Standard random number generators</span><span>
</span><span id="line-56"></span><span>	</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">StdGen</span><span>
</span><span id="line-57"></span><span>	</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkStdGen</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span>	</span><span class="hs-comment">-- ** The global random number generator</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>	</span><span class="hs-comment">-- $globalrng</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span>	</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getStdRandom</span><span>
</span><span id="line-64"></span><span>	</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getStdGen</span><span>
</span><span id="line-65"></span><span>	</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">setStdGen</span><span>
</span><span id="line-66"></span><span>	</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">newStdGen</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span>	</span><span class="hs-comment">-- * Random values of various types</span><span>
</span><span id="line-69"></span><span>	</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">random</span><span class="hs-special">,</span><span>   </span><span class="hs-identifier">randomR</span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>		   </span><span class="hs-identifier">randoms</span><span class="hs-special">,</span><span>  </span><span class="hs-identifier">randomRs</span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>		   </span><span class="hs-identifier">randomIO</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">randomRIO</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>	</span><span class="hs-comment">-- * References</span><span>
</span><span id="line-74"></span><span>	</span><span class="hs-comment">-- $references</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span>	</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Bits</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Int</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Word</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign.C.Types</span><span class="hs-cpp">

#ifdef __NHC__
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CPUTime</span><span>		</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">getCPUTime</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign.Ptr</span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">Ptr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nullPtr</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign.C</span><span>	</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">CTime</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">CUInt</span><span> </span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.CPUTime</span><span>	</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">getCPUTime</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Time</span><span>	</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">getCurrentTime</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">UTCTime</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Ratio</span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">numerator</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">denominator</span><span> </span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Char</span><span>	</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isSpace</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">chr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ord</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.IO.Unsafe</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">unsafePerformIO</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.IORef</span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">IORef</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">newIORef</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">readIORef</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">writeIORef</span><span> </span><span class="hs-special">)</span><span class="hs-cpp">
#if MIN_VERSION_base (4,6,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.IORef</span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">atomicModifyIORef'</span><span> </span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.IORef</span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">atomicModifyIORef</span><span> </span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Numeric</span><span>		</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">readDec</span><span> </span><span class="hs-special">)</span><span class="hs-cpp">

#ifdef __GLASGOW_HASKELL__
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Exts</span><span>         </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">build</span><span> </span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-comment">-- | A dummy variant of build without fusion.</span><span>
</span><span id="line-108"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">build</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-109"></span><span class="hs-identifier">build</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">a</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">a</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">a</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">a</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">a</span><span class="hs-special">]</span><span>
</span><span id="line-110"></span><span class="hs-identifier">build</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if !MIN_VERSION_base (4,6,0)
</span><span class="hs-identifier">atomicModifyIORef'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IORef</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">b</span><span>
</span><span id="line-115"></span><span class="hs-identifier">atomicModifyIORef'</span><span> </span><span class="hs-identifier">ref</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-identifier">b</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">atomicModifyIORef</span><span> </span><span class="hs-identifier">ref</span><span>
</span><span id="line-117"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">x</span><span>
</span><span id="line-118"></span><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">seq</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-identifier">b</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">seq</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">b</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- The standard nhc98 implementation of Time.ClockTime does not match</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- the extended one expected in this module, so we lash-up a quick</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- replacement here.</span><span class="hs-cpp">
#ifdef __NHC__
</span><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-string">&quot;time.h time&quot;</span><span> </span><span class="hs-identifier">readtime</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CTime</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CTime</span><span>
</span><span id="line-127"></span><span class="hs-identifier">getTime</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Integer</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Integer</span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span class="hs-identifier">getTime</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">CTime</span><span> </span><span class="hs-identifier">t</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">readtime</span><span> </span><span class="hs-identifier">nullPtr</span><span class="hs-special">;</span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">toInteger</span><span> </span><span class="hs-identifier">t</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-identifier">getTime</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Integer</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Integer</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span class="hs-identifier">getTime</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-identifier">utc</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getCurrentTime</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">daytime</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">toRational</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">utctDayTime</span><span> </span><span class="hs-identifier">utc</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">quotRem</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">numerator</span><span> </span><span class="hs-identifier">daytime</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">denominator</span><span> </span><span class="hs-identifier">daytime</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- | The class 'RandomGen' provides a common interface to random number</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- generators.</span><span>
</span><span id="line-139"></span><span class="hs-comment">--</span><span class="hs-cpp">
#ifdef ENABLE_SPLITTABLEGEN
</span><span class="hs-comment">-- Minimal complete definition: 'next'.</span><span class="hs-cpp">
#else
</span><span class="hs-comment">-- Minimal complete definition: 'next' and 'split'.</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-146"></span><span class="hs-keyword">class</span><span> </span><span class="hs-identifier">RandomGen</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>   </span><span class="hs-comment">-- |The 'next' operation returns an 'Int' that is uniformly distributed</span><span>
</span><span id="line-149"></span><span>   </span><span class="hs-comment">-- in the range returned by 'genRange' (including both end points),</span><span>
</span><span id="line-150"></span><span>   </span><span class="hs-comment">-- and a new generator.</span><span>
</span><span id="line-151"></span><span>   </span><span class="hs-identifier">next</span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>   </span><span class="hs-comment">-- |The 'genRange' operation yields the range of values returned by</span><span>
</span><span id="line-154"></span><span>   </span><span class="hs-comment">-- the generator.</span><span>
</span><span id="line-155"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-156"></span><span>   </span><span class="hs-comment">-- It is required that:</span><span>
</span><span id="line-157"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-158"></span><span>   </span><span class="hs-comment">-- * If @(a,b) = 'genRange' g@, then @a &lt; b@.</span><span>
</span><span id="line-159"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-160"></span><span>   </span><span class="hs-comment">-- * 'genRange' always returns a pair of defined 'Int's.</span><span>
</span><span id="line-161"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-162"></span><span>   </span><span class="hs-comment">-- The second condition ensures that 'genRange' cannot examine its</span><span>
</span><span id="line-163"></span><span>   </span><span class="hs-comment">-- argument, and hence the value it returns can be determined only by the</span><span>
</span><span id="line-164"></span><span>   </span><span class="hs-comment">-- instance of 'RandomGen'.  That in turn allows an implementation to make</span><span>
</span><span id="line-165"></span><span>   </span><span class="hs-comment">-- a single call to 'genRange' to establish a generator's range, without</span><span>
</span><span id="line-166"></span><span>   </span><span class="hs-comment">-- being concerned that the generator returned by (say) 'next' might have</span><span>
</span><span id="line-167"></span><span>   </span><span class="hs-comment">-- a different range to the generator passed to 'next'.</span><span>
</span><span id="line-168"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-169"></span><span>   </span><span class="hs-comment">-- The default definition spans the full range of 'Int'.</span><span>
</span><span id="line-170"></span><span>   </span><span class="hs-identifier">genRange</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Int</span><span class="hs-special">,</span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span>   </span><span class="hs-comment">-- default method</span><span>
</span><span id="line-173"></span><span>   </span><span class="hs-identifier">genRange</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">minBound</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">maxBound</span><span class="hs-special">)</span><span class="hs-cpp">

#ifdef ENABLE_SPLITTABLEGEN
</span><span class="hs-comment">-- | The class 'SplittableGen' proivides a way to specify a random number</span><span>
</span><span id="line-177"></span><span class="hs-comment">--   generator that can be split into two new generators.</span><span>
</span><span id="line-178"></span><span class="hs-keyword">class</span><span> </span><span class="hs-identifier">SplittableGen</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">
#endif
</span><span>   </span><span class="hs-comment">-- |The 'split' operation allows one to obtain two distinct random number</span><span>
</span><span id="line-181"></span><span>   </span><span class="hs-comment">-- generators. This is very useful in functional programs (for example, when</span><span>
</span><span id="line-182"></span><span>   </span><span class="hs-comment">-- passing a random number generator down to recursive calls), but very</span><span>
</span><span id="line-183"></span><span>   </span><span class="hs-comment">-- little work has been done on statistically robust implementations of</span><span>
</span><span id="line-184"></span><span>   </span><span class="hs-comment">-- 'split' ([&quot;System.Random\#Burton&quot;, &quot;System.Random\#Hellekalek&quot;]</span><span>
</span><span id="line-185"></span><span>   </span><span class="hs-comment">-- are the only examples we know of).</span><span>
</span><span id="line-186"></span><span>   </span><span class="hs-identifier">split</span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">g</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-comment">{- |
The 'StdGen' instance of 'RandomGen' has a 'genRange' of at least 30 bits.

The result of repeatedly using 'next' should be at least as statistically
robust as the /Minimal Standard Random Number Generator/ described by
[&quot;System.Random\#Park&quot;, &quot;System.Random\#Carta&quot;].
Until more is known about implementations of 'split', all we require is
that 'split' deliver generators that are (a) not identical and
(b) independently robust in the sense just given.

The 'Show' and 'Read' instances of 'StdGen' provide a primitive way to save the
state of a random number generator.
It is required that @'read' ('show' g) == g@.

In addition, 'reads' may be used to map an arbitrary string (not necessarily one
produced by 'show') onto a value of type 'StdGen'. In general, the 'Read'
instance of 'StdGen' has the following properties: 

* It guarantees to succeed on any string. 

* It guarantees to consume only a finite portion of the string. 

* Different argument strings are likely to result in different results.

-}</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">StdGen</span><span> </span><span>
</span><span id="line-215"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">Int32</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">Int32</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">RandomGen</span><span> </span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-identifier">next</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">stdNext</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-identifier">genRange</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">stdRange</span><span class="hs-cpp">

#ifdef ENABLE_SPLITTABLEGEN
</span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">SplittableGen</span><span> </span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="hs-identifier">split</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">stdSplit</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Show</span><span> </span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-identifier">showsPrec</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-identifier">s1</span><span> </span><span class="hs-identifier">s2</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-228"></span><span>     </span><span class="hs-identifier">showsPrec</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">s1</span><span> </span><span class="hs-operator">.</span><span> </span><span>
</span><span id="line-229"></span><span>     </span><span class="hs-identifier">showChar</span><span> </span><span class="hs-char">' '</span><span> </span><span class="hs-operator">.</span><span>
</span><span id="line-230"></span><span>     </span><span class="hs-identifier">showsPrec</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">s2</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Read</span><span> </span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-identifier">readsPrec</span><span> </span><span class="hs-identifier">_p</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-234"></span><span>     </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">try_read</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-235"></span><span>       </span><span class="hs-identifier">r'</span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">r'</span><span>
</span><span id="line-236"></span><span>       </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">stdFromString</span><span> </span><span class="hs-identifier">r</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- because it shouldn't ever fail.</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span>
</span><span id="line-238"></span><span>      </span><span class="hs-identifier">try_read</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>         </span><span class="hs-special">(</span><span class="hs-identifier">s1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">r1</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">readDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">dropWhile</span><span> </span><span class="hs-identifier">isSpace</span><span> </span><span class="hs-identifier">r</span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>	 </span><span class="hs-special">(</span><span class="hs-identifier">s2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">r2</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">readDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">dropWhile</span><span> </span><span class="hs-identifier">isSpace</span><span> </span><span class="hs-identifier">r1</span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>	 </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-identifier">s1</span><span> </span><span class="hs-identifier">s2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">r2</span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-comment">{-
 If we cannot unravel the StdGen from a string, create
 one based on the string given.
-}</span><span>
</span><span id="line-247"></span><span class="hs-identifier">stdFromString</span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">StdGen</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">String</span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span class="hs-identifier">stdFromString</span><span> </span><span class="hs-identifier">s</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mkStdGen</span><span> </span><span class="hs-identifier">num</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rest</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>	</span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">cs</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rest</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">splitAt</span><span> </span><span class="hs-number">6</span><span> </span><span class="hs-identifier">s</span><span>
</span><span id="line-250"></span><span>              </span><span class="hs-identifier">num</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">foldl</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">ord</span><span> </span><span class="hs-identifier">cs</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="hs-comment">{- |
The function 'mkStdGen' provides an alternative way of producing an initial
generator, by mapping an 'Int' into a generator. Again, distinct arguments
should be likely to produce distinct generators.
-}</span><span>
</span><span id="line-258"></span><span class="hs-identifier">mkStdGen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-comment">-- why not Integer ?</span><span>
</span><span id="line-259"></span><span class="hs-identifier">mkStdGen</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mkStdGen32</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">s</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="hs-comment">{-
From [&quot;System.Random\#LEcuyer&quot;]: &quot;The integer variables s1 and s2 ... must be
initialized to values in the range [1, 2147483562] and [1, 2147483398]
respectively.&quot;
-}</span><span>
</span><span id="line-266"></span><span class="hs-identifier">mkStdGen32</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">StdGen</span><span>
</span><span id="line-267"></span><span class="hs-identifier">mkStdGen32</span><span> </span><span class="hs-identifier">sMaybeNegative</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">s1</span><span class="hs-operator">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">s2</span><span class="hs-operator">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-269"></span><span>	</span><span class="hs-comment">-- We want a non-negative number, but we can't just take the abs</span><span>
</span><span id="line-270"></span><span>	</span><span class="hs-comment">-- of sMaybeNegative as -minBound == minBound.</span><span>
</span><span id="line-271"></span><span>	</span><span class="hs-identifier">s</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sMaybeNegative</span><span> </span><span class="hs-operator">.&amp;.</span><span> </span><span class="hs-identifier">maxBound</span><span>
</span><span id="line-272"></span><span>	</span><span class="hs-special">(</span><span class="hs-identifier">q</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">s1</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">divMod</span><span class="hs-special">`</span><span> </span><span class="hs-number">2147483562</span><span>
</span><span id="line-273"></span><span>	</span><span class="hs-identifier">s2</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">2147483398</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="hs-identifier">createStdGen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">StdGen</span><span>
</span><span id="line-276"></span><span class="hs-identifier">createStdGen</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mkStdGen32</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">s</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-comment">{- |
With a source of random number supply in hand, the 'Random' class allows the
programmer to extract random values of a variety of types.

Minimal complete definition: 'randomR' and 'random'.

-}</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="hs-keyword">class</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-comment">-- | Takes a range /(lo,hi)/ and a random number generator</span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-comment">-- /g/, and returns a random value uniformly distributed in the closed</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-comment">-- interval /[lo,hi]/, together with a new generator. It is unspecified</span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-comment">-- what happens if /lo&gt;hi/. For continuous types there is no requirement</span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-comment">-- that the values /lo/ and /hi/ are ever produced, but they may be,</span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-comment">-- depending on the implementation and the interval.</span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">RandomGen</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-identifier">g</span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-comment">-- | The same as 'randomR', but using a default range determined by the type:</span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-comment">-- * For bounded types (instances of 'Bounded', such as 'Char'),</span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-comment">--   the range is normally the whole type.</span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-comment">-- * For fractional types, the range is normally the semi-closed interval</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-comment">-- @[0,1)@.</span><span>
</span><span id="line-302"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-comment">-- * For 'Integer', the range is (arbitrarily) the range of 'Int'.</span><span>
</span><span id="line-304"></span><span>  </span><span class="hs-identifier">random</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">RandomGen</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-comment">-- | Plural variant of 'randomR', producing an infinite list of</span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-comment">-- random values instead of returning a new generator.</span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">randomRs</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-identifier">randomRs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">RandomGen</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">a</span><span class="hs-special">]</span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-identifier">randomRs</span><span> </span><span class="hs-identifier">ival</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">build</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">cons</span><span> </span><span class="hs-identifier">_nil</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">buildRandoms</span><span> </span><span class="hs-identifier">cons</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">randomR</span><span> </span><span class="hs-identifier">ival</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-comment">-- | Plural variant of 'random', producing an infinite list of</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-comment">-- random values instead of returning a new generator.</span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">randoms</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-identifier">randoms</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">RandomGen</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">a</span><span class="hs-special">]</span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-identifier">randoms</span><span>  </span><span class="hs-identifier">g</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">build</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">cons</span><span> </span><span class="hs-identifier">_nil</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">buildRandoms</span><span> </span><span class="hs-identifier">cons</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-comment">-- | A variant of 'randomR' that uses the global random number generator</span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-comment">-- (see &quot;System.Random#globalrng&quot;).</span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-identifier">randomRIO</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-321"></span><span>  </span><span class="hs-identifier">randomRIO</span><span> </span><span class="hs-identifier">range</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getStdRandom</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">randomR</span><span> </span><span class="hs-identifier">range</span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-comment">-- | A variant of 'random' that uses the global random number generator</span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-comment">-- (see &quot;System.Random#globalrng&quot;).</span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-identifier">randomIO</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-identifier">randomIO</span><span>	   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getStdRandom</span><span> </span><span class="hs-identifier">random</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-comment">-- | Produce an infinite list-equivalent of random values.</span><span>
</span><span id="line-329"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">buildRandoms</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-330"></span><span class="hs-identifier">buildRandoms</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">RandomGen</span><span> </span><span class="hs-identifier">g</span><span>
</span><span id="line-331"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ E.g. '(:)' but subject to fusion</span><span>
</span><span id="line-332"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-identifier">g</span><span class="hs-special">)</span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- ^ E.g. 'random'</span><span>
</span><span id="line-333"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">g</span><span>                </span><span class="hs-comment">-- ^ A 'RandomGen' instance</span><span>
</span><span id="line-334"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">as</span><span>
</span><span id="line-335"></span><span class="hs-identifier">buildRandoms</span><span> </span><span class="hs-identifier">cons</span><span> </span><span class="hs-identifier">rand</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">go</span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-comment">-- The seq fixes part of #4218 and also makes fused Core simpler.</span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">seq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">cons</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">g'</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-special">,</span><span class="hs-identifier">g'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">rand</span><span> </span><span class="hs-identifier">g</span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">Integer</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-identifier">ival</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalInteger</span><span> </span><span class="hs-identifier">ival</span><span> </span><span class="hs-identifier">g</span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-identifier">random</span><span> </span><span class="hs-identifier">g</span><span>	 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">minBound</span><span class="hs-glyph">::</span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">maxBound</span><span class="hs-glyph">::</span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">g</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">Int</span><span>        </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-346"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">Int8</span><span>       </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-347"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">Int16</span><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-348"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">Int32</span><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-349"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">Int64</span><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span class="hs-cpp">

#ifndef __NHC__
</span><span class="hs-comment">-- Word is a type synonym in nhc98.</span><span>
</span><span id="line-353"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">Word</span><span>       </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">Word8</span><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-356"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">Word16</span><span>     </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-357"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">Word32</span><span>     </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-358"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">Word64</span><span>     </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CChar</span><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-361"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CSChar</span><span>     </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-362"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CUChar</span><span>     </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-363"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CShort</span><span>     </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-364"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CUShort</span><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-365"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CInt</span><span>       </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-366"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CUInt</span><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-367"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CLong</span><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-368"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CULong</span><span>     </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-369"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CPtrdiff</span><span>   </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-370"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CSize</span><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-371"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CWchar</span><span>     </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-372"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CSigAtomic</span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-373"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CLLong</span><span>     </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-374"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CULLong</span><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-375"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CIntPtr</span><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-376"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CUIntPtr</span><span>   </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-377"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CIntMax</span><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-378"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CUIntMax</span><span>   </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalIntegral</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomBounded</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">Char</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-382"></span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">randomIvalInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ord</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ord</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-383"></span><span>         </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-special">,</span><span class="hs-identifier">g'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">chr</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g'</span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-identifier">random</span><span> </span><span class="hs-identifier">g</span><span>	  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">minBound</span><span class="hs-special">,</span><span class="hs-identifier">maxBound</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">g</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-388"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">randomIvalInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">bool2Int</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bool2Int</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-389"></span><span>        </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">int2Bool</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g'</span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-391"></span><span>         </span><span class="hs-identifier">bool2Int</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Integer</span><span>
</span><span id="line-392"></span><span>         </span><span class="hs-identifier">bool2Int</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><span id="line-393"></span><span>         </span><span class="hs-identifier">bool2Int</span><span> </span><span class="hs-identifier">True</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span>	 </span><span class="hs-identifier">int2Bool</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><span id="line-396"></span><span>	 </span><span class="hs-identifier">int2Bool</span><span> </span><span class="hs-number">0</span><span>	</span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><span id="line-397"></span><span>	 </span><span class="hs-identifier">int2Bool</span><span> </span><span class="hs-identifier">_</span><span>	</span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-identifier">random</span><span> </span><span class="hs-identifier">g</span><span>	  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">minBound</span><span class="hs-special">,</span><span class="hs-identifier">maxBound</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">g</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">randomRFloating</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-402"></span><span class="hs-identifier">randomRFloating</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Fractional</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Num</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ord</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">RandomGen</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span class="hs-identifier">randomRFloating</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">h</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">g</span><span> </span><span>
</span><span id="line-404"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">l</span><span class="hs-operator">&gt;</span><span class="hs-identifier">h</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomRFloating</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">h</span><span class="hs-special">,</span><span class="hs-identifier">l</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">g</span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">coef</span><span class="hs-special">,</span><span class="hs-identifier">g'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-keyword">in</span><span> </span><span>
</span><span id="line-406"></span><span>		  </span><span class="hs-special">(</span><span class="hs-number">2.0</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-special">(</span><span class="hs-number">0.5</span><span class="hs-operator">*</span><span class="hs-identifier">l</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-identifier">coef</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-special">(</span><span class="hs-number">0.5</span><span class="hs-operator">*</span><span class="hs-identifier">h</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">0.5</span><span class="hs-operator">*</span><span class="hs-identifier">l</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g'</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- avoid overflow</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">Double</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-409"></span><span>  </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomRFloating</span><span>
</span><span id="line-410"></span><span>  </span><span class="hs-identifier">random</span><span> </span><span class="hs-identifier">rng</span><span>     </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-identifier">rng</span><span> </span><span class="hs-keyword">of</span><span> </span><span>
</span><span id="line-412"></span><span>      </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-special">,</span><span class="hs-identifier">rng'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><span id="line-413"></span><span>          </span><span class="hs-comment">-- We use 53 bits of randomness corresponding to the 53 bit significand:</span><span>
</span><span id="line-414"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mask53</span><span> </span><span class="hs-operator">.&amp;.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-glyph">::</span><span class="hs-identifier">Int64</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Double</span><span class="hs-special">)</span><span>  </span><span>
</span><span id="line-415"></span><span>	   </span><span class="hs-operator">/</span><span>  </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">twoto53</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rng'</span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>   </span><span class="hs-keyword">where</span><span> </span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-identifier">twoto53</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-glyph">::</span><span class="hs-identifier">Int64</span><span class="hs-special">)</span><span> </span><span class="hs-operator">^</span><span> </span><span class="hs-special">(</span><span class="hs-number">53</span><span class="hs-glyph">::</span><span class="hs-identifier">Int64</span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-identifier">mask53</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">twoto53</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-419"></span><span> </span><span>
</span><span id="line-420"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">Float</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomRFloating</span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-identifier">random</span><span> </span><span class="hs-identifier">rng</span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-423"></span><span>    </span><span class="hs-comment">-- TODO: Faster to just use 'next' IF it generates enough bits of randomness.   </span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-identifier">rng</span><span> </span><span class="hs-keyword">of</span><span> </span><span>
</span><span id="line-425"></span><span>      </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-special">,</span><span class="hs-identifier">rng'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><span id="line-426"></span><span>          </span><span class="hs-comment">-- We use 24 bits of randomness corresponding to the 24 bit significand:</span><span>
</span><span id="line-427"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mask24</span><span> </span><span class="hs-operator">.&amp;.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-glyph">::</span><span class="hs-identifier">Int32</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Float</span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-428"></span><span>	   </span><span class="hs-operator">/</span><span>  </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">twoto24</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rng'</span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>	 </span><span class="hs-comment">-- Note, encodeFloat is another option, but I'm not seeing slightly</span><span>
</span><span id="line-430"></span><span>	 </span><span class="hs-comment">--  worse performance with the following [2011.06.25]:</span><span>
</span><span id="line-431"></span><span class="hs-comment">--         (encodeFloat rand (-24), rng')</span><span>
</span><span id="line-432"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-433"></span><span>     </span><span class="hs-identifier">mask24</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">twoto24</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-434"></span><span>     </span><span class="hs-identifier">twoto24</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-glyph">::</span><span class="hs-identifier">Int32</span><span class="hs-special">)</span><span> </span><span class="hs-operator">^</span><span> </span><span class="hs-special">(</span><span class="hs-number">24</span><span class="hs-glyph">::</span><span class="hs-identifier">Int32</span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span class="hs-comment">-- CFloat/CDouble are basically the same as a Float/Double:</span><span>
</span><span id="line-437"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CFloat</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-438"></span><span>  </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomRFloating</span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-identifier">random</span><span> </span><span class="hs-identifier">rng</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">random</span><span> </span><span class="hs-identifier">rng</span><span> </span><span class="hs-keyword">of</span><span> </span><span>
</span><span id="line-440"></span><span>  	         </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-special">,</span><span class="hs-identifier">rng'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">realToFrac</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-glyph">::</span><span class="hs-identifier">Float</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rng'</span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">CDouble</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomRFloating</span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-comment">-- A MYSTERY:</span><span>
</span><span id="line-445"></span><span>  </span><span class="hs-comment">-- Presently, this is showing better performance than the Double instance:</span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-comment">-- (And yet, if the Double instance uses randomFrac then its performance is much worse!)</span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-identifier">random</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomFrac</span><span>
</span><span id="line-448"></span><span>  </span><span class="hs-comment">-- random rng = case random rng of </span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-comment">-- 	         (x,rng') -&gt; (realToFrac (x::Double), rng')</span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span class="hs-identifier">mkStdRNG</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">StdGen</span><span>
</span><span id="line-452"></span><span class="hs-identifier">mkStdRNG</span><span> </span><span class="hs-identifier">o</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-identifier">ct</span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getCPUTime</span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-special">(</span><span class="hs-identifier">sec</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psec</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getTime</span><span>
</span><span id="line-455"></span><span>    </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">createStdGen</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sec</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-number">12345</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-identifier">psec</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-identifier">ct</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-identifier">o</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="hs-identifier">randomBounded</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RandomGen</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Random</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Bounded</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span class="hs-identifier">randomBounded</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">minBound</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">maxBound</span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span class="hs-comment">-- The two integer functions below take an [inclusive,inclusive] range.</span><span>
</span><span id="line-461"></span><span class="hs-identifier">randomIvalIntegral</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RandomGen</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Integral</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span class="hs-identifier">randomIvalIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">h</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">toInteger</span><span> </span><span class="hs-identifier">l</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">toInteger</span><span> </span><span class="hs-identifier">h</span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="hs-pragma">randomIvalInteger</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">Num</span><span> </span><span class="hs-pragma">a</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=&gt;</span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-pragma">(</span><span class="hs-pragma">Integer</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Integer</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">StdGen</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">a</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">StdGen</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-466"></span><span>        </span><span>
</span><span id="line-467"></span><span class="hs-identifier">randomIvalInteger</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RandomGen</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Num</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Integer</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Integer</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span class="hs-identifier">randomIvalInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">h</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">rng</span><span>
</span><span id="line-469"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-operator">&gt;</span><span> </span><span class="hs-identifier">h</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">h</span><span class="hs-special">,</span><span class="hs-identifier">l</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">rng</span><span>
</span><span id="line-470"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">f</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">rng</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">v</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rng'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">mod</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">k</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rng'</span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-472"></span><span>       </span><span class="hs-special">(</span><span class="hs-identifier">genlo</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">genhi</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">genRange</span><span> </span><span class="hs-identifier">rng</span><span>
</span><span id="line-473"></span><span>       </span><span class="hs-identifier">b</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">genhi</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">genlo</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span>       </span><span class="hs-comment">-- Probabilities of the most likely and least likely result</span><span>
</span><span id="line-476"></span><span>       </span><span class="hs-comment">-- will differ at most by a factor of (1 +- 1/q).  Assuming the RandomGen</span><span>
</span><span id="line-477"></span><span>       </span><span class="hs-comment">-- is uniform, of course</span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span>       </span><span class="hs-comment">-- On average, log q / log b more random values will be generated</span><span>
</span><span id="line-480"></span><span>       </span><span class="hs-comment">-- than the minimum</span><span>
</span><span id="line-481"></span><span>       </span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1000</span><span>
</span><span id="line-482"></span><span>       </span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">h</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-483"></span><span>       </span><span class="hs-identifier">magtgt</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-identifier">q</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>       </span><span class="hs-comment">-- generate random values until we exceed the target magnitude </span><span>
</span><span id="line-486"></span><span>       </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">mag</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">mag</span><span> </span><span class="hs-operator">&gt;=</span><span> </span><span class="hs-identifier">magtgt</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">v</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">v'</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">seq</span><span class="hs-special">`</span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mag</span><span class="hs-operator">*</span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">v'</span><span> </span><span class="hs-identifier">g'</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-488"></span><span>                        </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-special">,</span><span class="hs-identifier">g'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">next</span><span> </span><span class="hs-identifier">g</span><span>
</span><span id="line-489"></span><span>                        </span><span class="hs-identifier">v'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">v</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">genlo</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span class="hs-comment">-- The continuous functions on the other hand take an [inclusive,exclusive) range.</span><span>
</span><span id="line-493"></span><span class="hs-identifier">randomFrac</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RandomGen</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Fractional</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span class="hs-identifier">randomFrac</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalDouble</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-glyph">::</span><span class="hs-identifier">Double</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">realToFrac</span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span class="hs-identifier">randomIvalDouble</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">RandomGen</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Fractional</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Double</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Double</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g</span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span class="hs-identifier">randomIvalDouble</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">h</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fromDouble</span><span> </span><span class="hs-identifier">rng</span><span> </span><span>
</span><span id="line-498"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-operator">&gt;</span><span> </span><span class="hs-identifier">h</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">randomIvalDouble</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">h</span><span class="hs-special">,</span><span class="hs-identifier">l</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fromDouble</span><span> </span><span class="hs-identifier">rng</span><span>
</span><span id="line-499"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-500"></span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">randomIvalInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">minBound</span><span class="hs-glyph">::</span><span class="hs-identifier">Int32</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">maxBound</span><span class="hs-glyph">::</span><span class="hs-identifier">Int32</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">rng</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-501"></span><span>         </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rng'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><span id="line-502"></span><span>	    </span><span class="hs-keyword">let</span><span>
</span><span id="line-503"></span><span>	     </span><span class="hs-identifier">scaled_x</span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-504"></span><span>		</span><span class="hs-identifier">fromDouble</span><span> </span><span class="hs-special">(</span><span class="hs-number">0.5</span><span class="hs-operator">*</span><span class="hs-identifier">l</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-number">0.5</span><span class="hs-operator">*</span><span class="hs-identifier">h</span><span class="hs-special">)</span><span> </span><span class="hs-operator">+</span><span>                   </span><span class="hs-comment">-- previously (l+h)/2, overflowed</span><span>
</span><span id="line-505"></span><span>                </span><span class="hs-identifier">fromDouble</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-number">0.5</span><span class="hs-operator">*</span><span class="hs-identifier">h</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">0.5</span><span class="hs-operator">*</span><span class="hs-identifier">l</span><span class="hs-special">)</span><span> </span><span class="hs-operator">/</span><span> </span><span class="hs-special">(</span><span class="hs-number">0.5</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-identifier">realToFrac</span><span> </span><span class="hs-identifier">int32Count</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator">*</span><span>  </span><span class="hs-comment">-- avoid overflow</span><span>
</span><span id="line-506"></span><span>		</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-glyph">::</span><span class="hs-identifier">Int32</span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>	    </span><span class="hs-keyword">in</span><span>
</span><span id="line-508"></span><span>	    </span><span class="hs-special">(</span><span class="hs-identifier">scaled_x</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rng'</span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span class="hs-identifier">int32Count</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Integer</span><span>
</span><span id="line-511"></span><span class="hs-identifier">int32Count</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">maxBound</span><span class="hs-glyph">::</span><span class="hs-identifier">Int32</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">minBound</span><span class="hs-glyph">::</span><span class="hs-identifier">Int32</span><span class="hs-special">)</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-number">1</span><span>  </span><span class="hs-comment">-- GHC ticket #3982</span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span class="hs-identifier">stdRange</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Int</span><span class="hs-special">,</span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span class="hs-identifier">stdRange</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">2147483562</span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span class="hs-identifier">stdNext</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">StdGen</span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span class="hs-comment">-- Returns values in the range stdRange</span><span>
</span><span id="line-518"></span><span class="hs-identifier">stdNext</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-identifier">s1</span><span> </span><span class="hs-identifier">s2</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">z'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-identifier">s1''</span><span> </span><span class="hs-identifier">s2''</span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>	</span><span class="hs-keyword">where</span><span>	</span><span class="hs-identifier">z'</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">z</span><span> </span><span class="hs-operator">&lt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">z</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-number">2147483562</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">z</span><span>
</span><span id="line-520"></span><span>		</span><span class="hs-identifier">z</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">s1''</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">s2''</span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span>		</span><span class="hs-identifier">k</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">s1</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">quot</span><span class="hs-special">`</span><span> </span><span class="hs-number">53668</span><span>
</span><span id="line-523"></span><span>		</span><span class="hs-identifier">s1'</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">40014</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">s1</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-number">53668</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-number">12211</span><span>
</span><span id="line-524"></span><span>		</span><span class="hs-identifier">s1''</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">s1'</span><span> </span><span class="hs-operator">&lt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">s1'</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-number">2147483563</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">s1'</span><span>
</span><span id="line-525"></span><span>    </span><span>
</span><span id="line-526"></span><span>		</span><span class="hs-identifier">k'</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">s2</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">quot</span><span class="hs-special">`</span><span> </span><span class="hs-number">52774</span><span>
</span><span id="line-527"></span><span>		</span><span class="hs-identifier">s2'</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">40692</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">s2</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">k'</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-number">52774</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">k'</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-number">3791</span><span>
</span><span id="line-528"></span><span>		</span><span class="hs-identifier">s2''</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">s2'</span><span> </span><span class="hs-operator">&lt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">s2'</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-number">2147483399</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">s2'</span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span class="hs-identifier">stdSplit</span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">StdGen</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">StdGen</span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span class="hs-identifier">stdSplit</span><span> </span><span class="hs-identifier">std</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-identifier">s1</span><span> </span><span class="hs-identifier">s2</span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">left</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">right</span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span>                       </span><span class="hs-keyword">where</span><span>
</span><span id="line-534"></span><span>                        </span><span class="hs-comment">-- no statistical foundation for this!</span><span>
</span><span id="line-535"></span><span>                        </span><span class="hs-identifier">left</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-identifier">new_s1</span><span> </span><span class="hs-identifier">t2</span><span>
</span><span id="line-536"></span><span>                        </span><span class="hs-identifier">right</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-identifier">t1</span><span> </span><span class="hs-identifier">new_s2</span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span>                        </span><span class="hs-identifier">new_s1</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">s1</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-number">2147483562</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-539"></span><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">s1</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span>                        </span><span class="hs-identifier">new_s2</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">s2</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-number">1</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2147483398</span><span>
</span><span id="line-542"></span><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">s2</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span>                        </span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-identifier">t1</span><span> </span><span class="hs-identifier">t2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">snd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">next</span><span> </span><span class="hs-identifier">std</span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span class="hs-comment">-- The global random number generator</span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span class="hs-comment">{- $globalrng #globalrng#

There is a single, implicit, global random number generator of type
'StdGen', held in some global variable maintained by the 'IO' monad. It is
initialised automatically in some system-dependent fashion, for example, by
using the time of day, or Linux's kernel random number generator. To get
deterministic behaviour, use 'setStdGen'.
-}</span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span class="hs-comment">-- |Sets the global random number generator.</span><span>
</span><span id="line-558"></span><span class="hs-identifier">setStdGen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-559"></span><span class="hs-identifier">setStdGen</span><span> </span><span class="hs-identifier">sgen</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">writeIORef</span><span> </span><span class="hs-identifier">theStdGen</span><span> </span><span class="hs-identifier">sgen</span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span class="hs-comment">-- |Gets the global random number generator.</span><span>
</span><span id="line-562"></span><span class="hs-identifier">getStdGen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">StdGen</span><span>
</span><span id="line-563"></span><span class="hs-identifier">getStdGen</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">readIORef</span><span> </span><span class="hs-identifier">theStdGen</span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span class="hs-identifier">theStdGen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IORef</span><span> </span><span class="hs-identifier">StdGen</span><span>
</span><span id="line-566"></span><span class="hs-identifier">theStdGen</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafePerformIO</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-567"></span><span>   </span><span class="hs-identifier">rng</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mkStdRNG</span><span> </span><span class="hs-number">0</span><span>
</span><span id="line-568"></span><span>   </span><span class="hs-identifier">newIORef</span><span> </span><span class="hs-identifier">rng</span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span class="hs-comment">-- |Applies 'split' to the current global random generator,</span><span>
</span><span id="line-571"></span><span class="hs-comment">-- updates it with one of the results, and returns the other.</span><span>
</span><span id="line-572"></span><span class="hs-identifier">newStdGen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">StdGen</span><span>
</span><span id="line-573"></span><span class="hs-identifier">newStdGen</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">atomicModifyIORef'</span><span> </span><span class="hs-identifier">theStdGen</span><span> </span><span class="hs-identifier">split</span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span class="hs-comment">{- |Uses the supplied function to get a value from the current global
random generator, and updates the global generator with the new generator
returned by the function. For example, @rollDice@ gets a random integer
between 1 and 6:

&gt;  rollDice :: IO Int
&gt;  rollDice = getStdRandom (randomR (1,6))

-}</span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span class="hs-identifier">getStdRandom</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">StdGen</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-identifier">StdGen</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-586"></span><span class="hs-identifier">getStdRandom</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">atomicModifyIORef'</span><span> </span><span class="hs-identifier">theStdGen</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">swap</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">f</span><span class="hs-special">)</span><span>
</span><span id="line-587"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">swap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">v</span><span class="hs-special">,</span><span class="hs-identifier">g</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">g</span><span class="hs-special">,</span><span class="hs-identifier">v</span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span class="hs-comment">{- $references

1. FW #Burton# Burton and RL Page, /Distributed random number generation/,
Journal of Functional Programming, 2(2):203-212, April 1992.

2. SK #Park# Park, and KW Miller, /Random number generators -
good ones are hard to find/, Comm ACM 31(10), Oct 1988, pp1192-1201.

3. DG #Carta# Carta, /Two fast implementations of the minimal standard
random number generator/, Comm ACM, 33(1), Jan 1990, pp87-88.

4. P #Hellekalek# Hellekalek, /Don\'t trust parallel Monte Carlo/,
Department of Mathematics, University of Salzburg,
&lt;http://random.mat.sbg.ac.at/~peter/pads98.ps&gt;, 1998.

5. Pierre #LEcuyer# L'Ecuyer, /Efficient and portable combined random
number generators/, Comm ACM, 31(6), Jun 1988, pp742-749.

The Web site &lt;http://random.mat.sbg.ac.at/&gt; is a great source of information.

-}</span><span>
</span><span id="line-610"></span></pre></body></html>